<mat-card>
  <!-- rgbDarkmode must be checked for strict equality to true/false 
  as if rgb is undefined, rgbDarkmode will be null/undefined
  which is falsy -->
  <div class="header-container"
    [ngClass]="{'darktheme': rgbDarkmode === true, 'lighttheme': rgbDarkmode === false}"
    [style.backgroundColor]="rgbString">
    <mat-card-title>
      <div class="position-relative region-name iv-custom-comp text">
        {{ region.name }}
        <small *ngIf="region.status"> ({{region.status}})</small>
      </div>
    </mat-card-title>

    <!-- subtitle on what it is -->
    <mat-card-subtitle class="d-inline-flex align-items-center">
      <mat-icon fontSet="fas" fontIcon="fa-brain"></mat-icon>
      <span>
        Brain region
      </span>

      <mat-divider vertical="true" class="ml-2 h-2rem"></mat-divider>

      <!-- origin datas -->
      <button mat-icon-button 
        [color]="previewDirective.active ? 'primary' : 'basic'"
        *ngFor="let originDataset of (region.originDatasets || []); let index = index"
        iav-dataset-preview-dataset-file
        [iav-dataset-preview-dataset-file-kgschema]="originDataset.kgSchema"
        [iav-dataset-preview-dataset-file-kgid]="originDataset.kgId"
        [iav-dataset-preview-dataset-file-filename]="originDataset.filename"
        #previewDirective="iavDatasetPreviewDatasetFile"
        iv-custom-comp
        [attr.primary]="previewDirective.active || null"
        role="switch"
        [attr.aria-checked]="previewDirective.active"
        [matTooltip]="SHOW_ORIGIN_DATASET"
        [attr.aria-label]="SHOW_ORIGIN_DATASET">
        <mat-icon fontSet="fas" fontIcon="fa-eye"></mat-icon>
        <!-- <span>
          View {{ regionOriginDatasetLabels$ | async | renderViewOriginDatasetlabel : index }}
        </span> -->
      </button>


      <!-- position -->
      <button mat-icon-button *ngIf="region?.position"
        (click)="navigateToRegion()"
        [matTooltip]="GO_TO_REGION_CENTROID + ': ' + (region.position | nmToMm | addUnitAndJoin : 'mm')">
        <mat-icon fontSet="fas" fontIcon="fa-map-marked-alt">
        </mat-icon>
      </button>

      <!-- region in other templates -->
      <button mat-icon-button
        *ngIf="showRegionInOtherTmpl"
        [attr.data-available-in-tmpl-count]="(regionInOtherTemplates$ | async).length"
        [attr.aria-label]="AVAILABILITY_IN_OTHER_REF_SPACE"
        [matMenuTriggerFor]="regionInOtherTemplatesMenu"
        [matMenuTriggerData]="{ regionInOtherTemplates: regionInOtherTemplates$ | async }">
        <i class="fas fa-globe"></i>
      </button>

    </mat-card-subtitle>

  </div>
</mat-card>

<!-- ToDo make dynamic with AVAILABLE CONNECTIVITY DATASETS data - get info from atlas viewer core -->
<mat-menu
  #connectivitySourceDatasets="matMenu"
  xPosition="before"
  hasBackdrop="false">
  <div>
    <button mat-menu-item (mousedown)="showConnectivity(region.name)">
      <span>1000 Brain Study - DTI connectivity</span>
    </button>
  </div>
</mat-menu>

<!-- template for switching template -->
<mat-menu #regionInOtherTemplatesMenu="matMenu"
  [aria-label]="SHOW_IN_OTHER_REF_SPACE">
  hello world
  <ng-template matMenuContent let-regionInOtherTemplates="regionInOtherTemplates">

    <mat-list-item *ngFor="let sameRegion of regionInOtherTemplates; let i = index"
      [attr.aria-label]="SHOW_IN_OTHER_REF_SPACE + ': ' + sameRegion.template.name + (sameRegion.hemisphere ? (' - ' + sameRegion.hemisphere) : '') "
      (click)="changeView(sameRegion)"
      mat-ripple
      [attr.role]="'button'">
      <mat-icon fontSet="fas" fontIcon="fa-none" mat-list-icon></mat-icon>
      <div mat-line>
        <ng-container *ngTemplateOutlet="regionInOtherTemplate; context: sameRegion">
        </ng-container>
      </div>
    </mat-list-item>
  </ng-template>
</mat-menu>

<!-- template for rendering template name and template hemisphere -->
<ng-template #regionInOtherTemplate let-template="template" let-hemisphere="hemisphere">
  <span class="overflow-x-hidden text-truncate"
  [matTooltip]="template.name  + (hemisphere ? (' ' + hemisphere) : '')">
    <span>
      {{ template.name }}
    </span>
    <span *ngIf="hemisphere" class="text-muted">
      ({{ hemisphere }})
    </span>
  </span>
</ng-template>
