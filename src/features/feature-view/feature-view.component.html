<ng-template #headerTmpl>
  <ng-content select="[header]"></ng-content>
</ng-template>

<mat-card *ngIf="!feature">

  <ng-template [ngTemplateOutlet]="headerTmpl"></ng-template>
  <span>
    Feature not specified.
  </span>
</mat-card>

<mat-card *ngIf="feature"
  class="mat-elevation-z4 sxplr-z-4">
  <mat-card-title>
    <ng-template [ngTemplateOutlet]="headerTmpl"></ng-template>
    <div class="feature-title">
      {{ feature.name }}
    </div>
  </mat-card-title>

  <mat-card-subtitle class="sxplr-d-inline-flex sxplr-align-items-stretch">
    <ng-template [ngIf]="feature.category">
      <mat-icon class="sxplr-m-a" fontSet="fas" fontIcon="fa-database"></mat-icon>
      <span class="sxplr-m-a">
        {{ feature.category }}
      </span>
    </ng-template>

    <mat-divider class="sxplr-pl-1" [vertical]="true"></mat-divider>

    <ng-template [ngIf]="busy$ | async">
      <spinner-cmp></spinner-cmp>
    </ng-template>

    <a mat-icon-button sxplr-hide-when-local *ngFor="let url of feature.link" [href]="url.href" target="_blank">
      <i class="fas fa-external-link-alt"></i>
    </a>
  </mat-card-subtitle>
</mat-card>

<mat-card *ngIf="feature" class="sxplr-z-0">
  <mat-card-content>
    <!-- TODO fix feature typing! with proper translate fn -->
    <markdown-dom class="sxplr-muted" [markdown]="feature.desc">
    </markdown-dom>
  </mat-card-content>
</mat-card>


<!-- tabular special view -->
<ng-template [ngIf]="tabular$ | async" let-tabular>
  <table class="feature-detail" mat-table [dataSource]="tabular | transformPdToDs">

    <ng-container *ngFor="let column of columns$ | async"
      [matColumnDef]="column">
      <th mat-header-cell *matHeaderCellDef>
        {{ column }}
      </th>
      <td mat-cell *matCellDef="let element">
        {{ element[column] }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columns$ | async"></tr>
    <tr mat-row *matRowDef="let row; columns: columns$ | async;"></tr>
  </table>
</ng-template>


<!-- voi special view -->
<ng-template [ngIf]="voi$ | async" let-voi>
  <ng-layer-ctl
    [ng-layer-ctl-name]="voi.ngVolume.url"
    [ng-layer-ctl-src]="voi.ngVolume.url"
    [ng-layer-ctl-transform]="voi.ngVolume.transform"
    [ng-layer-ctl-info]="voi.ngVolume.info"
    [ng-layer-ctl-opacity]="1.0">
  </ng-layer-ctl>
</ng-template>
