<mat-card>
    <mat-accordion>
        <mat-expansion-panel *ngFor="let keyvalue of (cateogryCollections$ | async | keyvalue)"
            sxplrCategoryAcc
            #categoryAcc="categoryAcc"
            [ngClass]="{
                'sxplr-d-none': !(categoryAcc.isBusy$ | async) && (categoryAcc.total$ | async) === 0
            }">

            <mat-expansion-panel-header>

                <mat-panel-title>
                    {{ keyvalue.key }}
                </mat-panel-title>
                
                <mat-panel-description>
                    <spinner-cmp *ngIf="categoryAcc.isBusy$ | async"></spinner-cmp>
                    <span>
                        {{ categoryAcc.total$ | async }}
                    </span>
                </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="c3-outer">
                <div class="c3-inner">
                    
                    <mat-card class="c3 mat-elevation-z4"
                        *ngFor="let feature of keyvalue.value"
                        [ngClass]="{
                            'sxplr-d-none': (list.state$ | async) === 'noresult'
                        }">
                        <mat-card-header>

                            <mat-card-title>
                                <span class="category-title sxplr-white-space-nowrap">
                                    {{ feature.name | featureNamePipe }}
                                </span>
                            </mat-card-title>
                            
                        </mat-card-header>


                        <mat-card-content>
                            <sxplr-feature-list
                                [template]="template"
                                [parcellation]="parcellation"
                                [region]="region"
                                [queryParams]="queryParams | mergeObj : { type: (feature.name | featureNamePipe) }"
                                [featureRoute]="feature.path"
                                (onClickFeature)="onClickFeature($event)"
                                #list="featureList"
                                >
                            </sxplr-feature-list>

                            <spinner-cmp *ngIf="(list.state$ | async) === 'busy'"></spinner-cmp>
                            
                        </mat-card-content>
                    </mat-card>
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>

</mat-card>

